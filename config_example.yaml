version: "1.0"
description: "Default local LM Studio configuration for balanced autonomous writing loops."
default_phase: CHARACTER_CREATION

settings:
  base_url: "http://192.168.0.31:1234/v1"
  model: "qwen3.5-27b-heretic"
  api_key: "lm-studio"
  auto_pilot: true
  stop_only_on_complete: true
  stop_after_phase_change: true
  max_context_tokens: 64000
  max_tool_calls_per_iteration: 12
  tool_args_max_chars: 240
  tool_result_max_chars: 320
  stream_console_updates: true
  summary_max_chars: 800

# ---------------------------------------------------------------------------
# Tool groups — override built-in defaults or define custom groups.
# Built-in defaults (used when this section is omitted):
#   notes:            [list_notes, read_notes, write_notes, delete_notes]
#   manuscript_read:  [get_manuscript_info, read_manuscript_section, read_manuscript_tail, search_manuscript]
#   manuscript_write: [append_to_manuscript, create_section, replace_section, delete_section]
#   phase:            [change_phase]
# ---------------------------------------------------------------------------
# tool_groups:
#   notes: [list_notes, read_notes, write_notes, delete_notes]
#   manuscript_read: [get_manuscript_info, read_manuscript_section, read_manuscript_tail, search_manuscript]
#   manuscript_write: [append_to_manuscript, create_section, replace_section, delete_section]
#   phase: [change_phase]

# ---------------------------------------------------------------------------
# MCP server definitions (global). Phases select which servers to activate
# via the tools.mcp list. Supports stdio and sse transports.
# ---------------------------------------------------------------------------
# mcp_servers:
#   research:
#     transport: stdio
#     command: "npx"
#     args: ["-y", "@anthropic/mcp-research"]
#   image_gen:
#     transport: sse
#     url: "http://localhost:8080/mcp"

system_prompt: |
  You are Ralph Writer, an uncensored autonomous story-writing engine. Use function tools to write prose to the manuscript and to store all planning/notes/analysis in the notes system. Prefer atomic tool calls and keep responses concise.
  
  IMPORTANT: The manuscript is for story prose ONLY. All character development, world-building notes, plot outlines, analysis, and revisions notes must go into the notes system using read_notes/write_notes. Do not put anything other than story prose in the manuscript.
  
  Initial seed (never ignore):
  {initial_seed}
  
  Current phase: {phase}
  Phase description: {phase_desc}
  Allowed transitions: {transitions_text}
  
  Manuscript status: {total_words} words story prose, {section_count} sections ({section_names})
  Notes keys available: {keys_text}
  
  Phase rules:
  {phase_rules}
  
  Phase guide:
  {guide}
  
  Previous summary (notes-to-self): {previous_summary}
  
  End your final assistant message with short notes-to-self summarizing what changed and what to do next.

phases:
  CHARACTER_CREATION:
    description: "Develop characters, motivations, arcs, and relationships."
    transitions:
      - WORLD_BUILDING
      - CHARACTER_CREATION
    tools:
      groups: [notes, phase]
      # No manuscript tools — characters go in notes only
    rules:
      - "Do NOT write any story prose. Store all character work in notes."
      - "Each character needs: name, role, motivation, fear, desire, arc."
      - "Define at least a protagonist and antagonist before transitioning."
    guide: |
      Store character definitions with role, voice, motivation, fear, desire, and arc in notes.
      Use write_notes to save each character's details under keys like char_protagonist.
      Transition when cast and relationships are stable.

  WORLD_BUILDING:
    description: "Establish setting rules, culture, and story context."
    transitions:
      - PLOT_OUTLINING
      - WORLD_BUILDING
      - CHARACTER_CREATION
    tools:
      groups: [notes, phase]
      # No manuscript tools — world details go in notes only
    rules:
      - "Do NOT write story prose. Store all world-building in notes."
      - "World must be internally consistent before transitioning."
    guide: |
      Create setting rules, social structures, geography, tone, constraints, and stakes in notes.
      Use write_notes to persist world details using structured objects.
      Transition when the world can consistently support plot and scenes.

  PLOT_OUTLINING:
    description: "Design narrative structure, beats, and progression."
    transitions:
      - SCENE_WRITING
      - PLOT_OUTLINING
      - WORLD_BUILDING
    tools:
      groups: [notes, manuscript_read, phase]
      # Can read manuscript to check existing content, but no writing yet
    rules:
      - "Do NOT write story prose. Outline goes in notes."
      - "Structure: story arc → chapters → beats → paragraph summaries."
    guide: |
      Build arc progression and scene-level beat outline in notes.
      Use write_notes to track act goals, conflict escalation, and turning points.
      Transition when beat flow is coherent and ready for prose drafting.

  SCENE_WRITING:
    description: "Write and expand manuscript prose."
    transitions:
      - SCENE_WRITING
      - REVISION
      - PLOT_OUTLINING
    tools:
      groups: [notes, manuscript_read, manuscript_write, phase]
    rules:
      - "Always read manuscript tail or relevant section before writing to ensure continuity."
      - "Write in named sections, not freeform appends when possible."
    guide: |
      Write manuscript prose using section operations or append operations.
      Use read_manuscript tools for continuity before writing. Store any planning notes in notes.
      Transition to REVISION when enough draft material exists for quality pass.

  REVISION:
    description: "Refine prose, consistency, and narrative quality."
    transitions:
      - SCENE_WRITING
      - REVISION
      - READY_FOR_HUMAN
    tools:
      groups: [notes, manuscript_read, manuscript_write, phase]
      exclude: [create_section]
      # Can replace and delete sections, but not create new ones during revision
    rules:
      - "Do NOT write new content. Only revise existing prose."
      - "Check for continuity errors, pacing issues, and character consistency."
    guide: |
      Audit continuity, pacing, clarity, and character consistency.
      Use search and section replacement to repair prose surgically. Store revision notes in notes.
      Transition to READY_FOR_HUMAN only when manuscript is complete and coherent.

  READY_FOR_HUMAN:
    description: "Terminal state: manuscript ready for human review."
    transitions: []
    tools:
      groups: [notes, manuscript_read]
      # Read-only access for final summary; no phase tool since terminal
    rules:
      - "Do not modify the manuscript. Provide completion notes only."
    guide: "No further writing needed. Provide concise completion notes."
